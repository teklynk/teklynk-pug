extends ../../layout/blog-layout.pug

block nav

block title
    - var date = "2025-12-26"
    - var title = "Building an RTMP Camera with Raspberry Pi Zero W"
    - var description = "Learn how to turn your Raspberry Pi Zero W into a wireless RTMP IP camera using RPiCam."
    - var thumbnail = "https://www.teklynk.com/assets/images/rpicam-2025-12-26.png"
    - var pageUrl = "https://www.teklynk.com/blog/building-an-rtmp-camera-with-raspberry-pi-zero-w"
    | Teklynk - #{title}

block content
    p I've had a Raspberry Pi Zero W and a Camera Module sitting on my desk for a long time, waiting for a project. My past attempts left me defeated, as the Pi Zero simply isn't that powerful.
    p With the holiday break here, I decided to give it another shot.
    p This time, I wanted to test the feasibility of running an RTMP server and RPiCam-Vid on this low-powered Pi Zero. Here are my notes from many hours of trial and error. Spoiler: it works... sort of.

    img.img-fluid.mb-4.shadow-sm(src="/assets/images/rpicam-2025-12-26.png", alt="Raspberry Pi Zero W in a black metal case. Camera module is stuck onto the outside with double sided foam tape")

    h2 Where to start?

    p To get an RTMP server running, I need to install NGINX along with the `libnginx-mod-rtmp` module. This extension allows the stream to be served to clients like VLC, MPV, or Celluloid via the `rtmp://` protocol.
    p On the capture side, I'll be using the `rpicam` suite (formerly `libcamera`), which is the standard way to interface with the Raspberry Pi Camera Module.
    p The final piece of the puzzle is connecting the two: I'll need to pipe the `rpicam` video feed into `ffmpeg` to push it to the RTMP server.
    
    p It sounds simple, but I'm skeptical about the Pi Zero's performance. The real challenge will be finding the right balance: what bitrate, framerate, and resolution will actually work?

    h2 The Setup 

    p I started with the Lite version of Raspberry Pi OS. Since the Pi Zero has limited resources, a desktop environment would be unnecessary overhead.
    p After flashing the OS, I went through the standard setup process: configuring localization and timezone, enabling SSH, and connecting to Wi-Fi.
    p Once connected, I could SSH into the Pi from my main computer, eliminating the need for a dedicated keyboard and monitor. This headless setup also makes it much easier to copy and paste commands.
    
    h3 1. Install Dependencies
    p First, install the required packages, including FFMPEG, NGINX, and the RTMP module:
    div.shadow-sm 
        pre.line-numbers
            code.language-bash.
                sudo apt install ffmpeg nginx libnginx-mod-rtmp rpicam-apps
    
    h3 2. Configure NGINX
    p We need to replace the default NGINX configuration to enable RTMP streaming. Edit `/etc/nginx/nginx.conf` and add the following:
    div.shadow-sm 
        pre.line-numbers
            code.language-bash.
                load_module modules/ngx_rtmp_module.so;
                worker_processes auto;

                events {
                    worker_connections 1024;
                }

                rtmp {
                    server {
                        listen 1935;
                        chunk_size 4096;

                        application live {
                            live on;
                            allow play all;
                            allow publish 127.0.0.1;
                            deny publish all;
                            meta off;          # Reduces overhead
                            wait_key on;       # Sync on keyframes
                            wait_video on;
                        }
                    }
                } 
    p Save the file and restart the NGINX service:
    div.shadow-sm
        pre.line-numbers
            code.language-bash.
                sudo systemctl restart nginx
    
    h3 3. Create the Streaming Service
    p To ensure the stream starts automatically on boot and restarts if it crashes, create a systemd service at `/etc/systemd/system/rpicam-stream.service`:
    div.shadow-sm 
        pre.line-numbers
            code.language-bash.
                [Unit]
                Description=Raspberry Pi Camera RTMP Stream
                After=network.target nginx.service
                Requires=nginx.service

                [Service]
                User=teklynk
                ExecStart=/bin/bash -c 'rpicam-vid -t 0 --width 640 --height 480 --framerate 25 --bitrate 500000 --nopreview -o - | ffmpeg -i - -vcodec copy -f flv rtmp://127.0.0.1/live/stream'
                Restart=always
                RestartSec=3

                [Install]
                WantedBy=multi-user.target
    
    p Reload the systemd daemon, then enable and start the service:
    div.shadow-sm
        pre.line-numbers
            code.language-bash.
                sudo systemctl daemon-reload 
                sudo systemctl enable rpicam-stream.service
                sudo systemctl start rpicam-stream.service 

    h3 4. Network Configuration
    p Setting a static IP ensures the camera always stays at the same address. I used `nmcli` to configure the IP, gateway, and DNS:
    div.shadow-sm 
        pre.line-numbers
            code.language-bash.
                sudo nmcli c mod "WIFI-SSID" ipv4.addresses 192.168.0.93/24 ipv4.method manual
                sudo nmcli con mod "WIFI-SSID" ipv4.gateway 192.168.0.1
                sudo nmcli con mod "WIFI-SSID" ipv4.dns 192.168.0.1
    
    p Apply the changes by restarting the connection:
    div.shadow-sm
        pre.line-numbers
            code.language-bash.
                sudo nmcli c down "WIFI-SSID" &amp;&amp; sudo nmcli c up "WIFI-SSID"

    h3 5. Verify the Stream
    p Finally, test the feed from another computer using a player like MPV or VLC:
    div.shadow-sm 
        pre.line-numbers
            code.language-bash.
                mpv rtmp://192.168.0.93/live/stream

    h2 Conclusion 

    p I successfully viewed the stream, though it had a significant lag of about 10 seconds. While the Pi Zero's CPU usage remained manageable, I suspect the onboard Wi-Fi antenna is the bottleneck.
    p Ultimately, it works. I can view the video feed on my computer and even pull up the RTMP stream on my phone. This setup is perfect for non-critical monitoring tasks like watching a 3D printer or a birdhouseâ€”scenarios where a few seconds of latency don't matter.